# Dario User Registration & Verification System

## Project Overview:

Developed a robust system to streamline the registration and verification process for B2B users for Dario. The goal is to simplify the user journey while ensuring only authorized individuals can register.

## Getting Started:

1. **Initial Setup**:

   - Set up an instance on phpMyAdmin.
   - Define necessary environment variables in the `src/config.php` file.

2. **Database Initialization**:

   - Utilize `dev-scripts/init-seed.php` to initialize and restart the database with basic configurations.

3. **Install required Composer libraries**:

composer install

4. **Mock Data Generation & Import**:

   - To generate an import file with mock user data, run `dev-scripts/generate-import-file`. By default, it will generate data for 100 users, but you can specify a different number as an argument, e.g., `dev-scripts/generate-import-file 500` to generate data for 500 users.
   - To import data from a file into the database, use `dev-scripts/import-file.php`. By default, it will look for the file generated by `generate-import-file`, but you can specify a different file path as an argument if needed.

5. **Admin Panel Access**:
   - Access the admin panel at https://bdaniel.net/dario/public/admin.php. Note: The messaging functionality is live, so use with caution.

---

**Admin Panel Email Testing Guide**:

1. Download the sample user file from the admin panel https://bdaniel.net/dario/public/admin.php.
2. Edit a user's email to your test address.
3. Upload the modified file back to the panel.
4. Click 'Send Email'. The edited user gets a landing page link.
5. Access the link, fill details, and get a confirmation email.
6. After submission, no more emails will be sent to that user.

---

## Key Development Choices:

1. **Database**: Opted for MySQL to support a large number of users. The data is indexed by unique identifiers to maximize efficiency.

2. **Workflow**: Upon initial login, a session token was integrated to reduce redundant database calls, ensuring a smooth user experience.

3. **Handling Large Files**: Incorporated stream processing for importing large files. Comprehensive data validation was conducted during the import process.

4. **Management System**: Developed an administrative panel enabling managers to upload, download, and dispatch messages to users.

5. **API Interfaces**: Established distinct API interfaces for users and administrators, facilitating a range of operations.

6. **Scalability**: Designed with a relational database structure using many-to-many user tables, which anticipates the future addition of products.

7. **User & Device Management**: Introduced a User Manager class that handles user and device related operations. Leveraged the PDO (PHP Data Objects) for database operations.

8. **HTML Templating**: Created an HTMLTemplate class that not only manages web pages but also email messages.

9. **Frontend**: Implemented an API class along with two inheriting classes, APIUser and APIAdmin, to efficiently manage frontend operations.

10. **Utility Scripts**: For development convenience, scripts were crafted to: initialize the database, generate import files for testing, and execute the import process from the generated file.

## Project Task Breakdown

### Backend Development:

1. **User Management**:

   - Develop the `UserManager` class to handle user and device related operations.
   - Implement functionalities to validate data during data stream imports: check for existing devices, skip existing users.

2. **Database Management**:

   - Choose MySQL for scalability and efficient handling of millions of users.
   - Implement indexing based on unique IDs for optimal query performance.
   - Setup a relational database with a many-to-many linking table to support future addition of products.

3. **HTML Templating**:

   - Design the `HTMLTemplate` class in PHP to generate HTML content for various frontend components.

4. **Session Management**:

   - Implement sessions to keep users logged in, ensuring minimal database queries.

5. **Admin Interface Backend**:

   - Setup functionalities to import/export user data.
   - Develop messaging functionality to notify users.

6. **Dev Scripts & Configuration**:
   - `init-seed.php`: Script to initialize and restart the database.
   - `dev-scripts/generate-import-file`: Generate a file for testing. It accepts an argument for the number of users, defaulting to 100 if not provided.
   - `dev-scripts/import-file.php`: Import user data from a file. Defaults to the file generated by `generate-import-file` unless another filename is provided.
   - Set up the configuration file located at `src/config.php` to manage database instances and environment-specific settings.

### Frontend Development:

1. **API Interaction**:

   - Develop the base `API` class.
   - Extend `API` class with `APIUser` and `APIAdmin` for user-specific and admin-specific functionalities.

2. **HTML Templating**:

   - Develop the `HTMLTemplate` class to manage page rendering and email messages.

3. **Landing Page**:

   - Design and implement the user landing page.
   - Use sessions to keep users logged in and reduce additional database calls.

4. **Admin Interface**:
   - Design and implement the admin dashboard interface.
   - Add features like file upload/download and user messaging.

## Team Assignment with Time Estimations

### Developer 1: Environment, Database Setup, and UserManager

1. **Environment Initialization** (1 hours):

   - Set up the local development environment.
   - Install and configure necessary tools and dependencies.
   - Set up initial project structure and integrate version control if needed.

2. **Database Configuration & Script Development** (3-4 hours):

   - Set up and configure the MySQL database from scratch.
   - Ensure the database supports millions of users by setting up appropriate indexing and establishing a relational structure.
   - Develop the `init-seed.php` script for database seeding and reinitialization.
   - Configure necessary variables in `src/config.php`.

3. **User Management** (6-7 hours):
   - Develop the `UserManager` class in PHP to handle user-related operations such as creation, update, deletion, device management, and session management.

### Developer 2: Server-Side API, Import Processes, Email Templates, and User & Admin API

1. **Data Import & Script Development** (3-4 hours):

   - Implement the data import process to efficiently stream large datasets into the MySQL database.
   - Use the `salsify/json-streaming-parser` library with a custom listener to parse and store data.
   - Develop scripts for generating and importing data (`generate-import-file`, `import-file.php`).

2. **Email System & Template Development** (1-2 hours):

   - Develop the `HtmlTemplate` class in PHP for generating html and email content.

3. **API Development** (3-4 hours):
   - Develop the server-side `API` for handling requests from the front end.

### Developer 3: Front-End Development & User Experience

1. **Front-End Basics** (2 hours):

   - Set up a basic framework or library for front-end development.
   - Develop the core CSS and JavaScript components.

2. **User Interface and Experience** (2-3 hours):
   - Design and implement user-facing pages with HTML and CSS.
   - Enhance the user experience by incorporating loaders, animations, and other interactive elements.
   - Develop a client-side `API` class to communicate with the server-side API and handle data operations.
   -

---

# SDK for Server Interaction (`public/js/api.js`)

This SDK provides a simple and intuitive way to interact with the server via the API.

## Classes:

### `Api`

A base class for making API calls.

#### Methods:

- **`fetchData(method, data)`**:

  - **Description**: Performs a call to the server and retrieves a JSON response.
  - **Parameters**:
    - `method`: The HTTP method (e.g., `GET`, `POST`).
    - `data`: Data to send.
  - **Returns**: A JSON object containing the server's response, or `null` in case of an error.

- **`fetchFormData(method, formData)`**:
  - **Description**: Sends a form to the server.
  - **Parameters**:
    - `method`: The HTTP method.
    - `formData`: The form to send.
  - **Returns**: A text response or `null` in case of an error.

### `UserApi` (inherits from `Api`)

Handles user-related operations.

#### Methods:

- **`validateUser({ uniqId, userEmail, userId })`**:
  - **Description**: Validates a user and retrieves their related data from the server.
  - **Parameters**:
    - `uniqId`: The user's unique identifier.
    - `userEmail`: The user's email address.
    - `userId`: The user's ID.
  - **Returns**: A JSON object with the user's data object and html or `null` in case of an error.

### `AdminApi` (inherits from `Api`)

Handles administrative operations.

#### Methods:

- **`sendEmailsToUsers()`**:

  - **Description**: Sends emails to users who haven't been approved yet.
  - **Returns**: A JSON object indicating the outcome of the operation.

- **`ImportUsers(formData)`**:
  - **Description**: Imports users using a specific form.
  - **Parameters**:
    - `formData`: The form containing the data for import.
  - **Returns**: A JSON object indicating the outcome of the operation or `null` in case of an error.

---

# Third-Party Integration Guide for Dario SDK

Welcome to the integration guide for Dario SDK. This document will guide you through the process of integrating our SDK into your platform.

## 1. Introduction

Our SDK provides an intuitive way to communicate with our server through API calls. Whether you are looking to validate users, send emails, or import user data, our SDK simplifies the process.

## 2. Prerequisites

Before starting, ensure you have:

- Access to the `public/js/api.js` file from our SDK.
- Basic understanding of JavaScript and asynchronous operations.
- An environment to test API calls.

## 3. Setup

1. **Include the SDK**:

   Embed our SDK in your project by including the `public/js/api.js` file.

   ```
   <script src="path_to/public/js/api.js"></script>
   ```

2. **Initialization**:

   Initialize the SDK by creating an instance of the desired class:

   ```
   const userAPI = new UserApi();
   const adminAPI = new AdminApi();
   ```

## 4. Making API Calls

### Validate User:

Use the `validateUser` method from the `UserApi` class:

```
const response = await userAPI.validateUser({ uniqId: '12345', userEmail: 'test@example.com', userId: '67890' });
console.log(response);
```

### Send Emails:

Use the `sendEmailsToUsers` method from the `AdminApi` class:

```
const response = await adminAPI.sendEmailsToUsers();
console.log(response);
```

### Import Users:

Use the `ImportUsers` method from the `AdminApi` class:

```
const formData = new FormData();
formData.append('data', userFile); // Assuming 'userFile' is the file you want to import.
const response = await adminAPI.ImportUsers(formData);
console.log(response);
```

## 5. Handling Responses

All API calls return either a JSON object with the data or a `null` value in case of an error. Ensure to handle these responses appropriately in your integration.
